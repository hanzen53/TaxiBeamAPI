<!DOCTYPE html>
<html lang="en" class="app"  >
<head>
  <meta charset="utf-8" />
  <title>TaxiMate | Web Monitor</title>
  <meta name="description" content="app, web app, responsive, admin dashboard, admin, flat, flat ui, ui kit, off screen nav" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> 
  <link rel="stylesheet" href="css/bootstrap.css" type="text/css" />
  <link rel="stylesheet" href="css/animate.css" type="text/css" />
  <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css" />
  <link rel="stylesheet" href="css/font.css" type="text/css" cache="false" />
  <link rel="stylesheet" href="css/app.css" type="text/css" />
  <!--[if lt IE 9]> 
    <script src="js/ie/html5shiv.js" cache="false"></script>
    <script src="js/ie/respond.min.js" cache="false"></script>
    <script src="js/ie/excanvas.js" cache="false"></script>
  <![endif]-->
  <script src="js/jquery.ui.touch-punch.min.js"></script>
  <link rel="stylesheet" href="//code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css">
  <script src="../assets/libs/angular/angular.js"></script>

  <script src="route/app.js"></script>
  <script src="controller/main.ctrl.js"></script>

  <!--link data-require="bootstrap-css@2.3.2" data-semver="2.3.2" rel="stylesheet" href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" /-->
  <!--script data-require="angular.js@1.1.5" data-semver="1.1.5" src="js/angular.min.js"></script-->
  <!--script data-require="angular-ui-bootstrap@0.3.0" data-semver="0.3.0" src="http://angular-ui.github.io/bootstrap/ui-bootstrap-tpls-0.3.0.min.js"></script-->  
  <!--script src="js/script.js"></script-->

  <script src="http://54.200.72.141:1112/socket.io/socket.io.js"></script>  
  <script src="../assets/libs/jquery/dist/jquery.min.js"></script> 
  <!--script src="http://cdn.leafletjs.com/leaflet-0.4.5/leaflet-src.js"></script-->
  <script src="http://hmap-dev.ecartmap.com/v1/hobbit-loader.js"></script>

    <script src="http://rawgithub.com/openplans/Leaflet.AnimatedMarker/master/src/AnimatedMarker.js"></script>
    <script src="http://rawgithub.com/makinacorpus/Leaflet.GeometryUtil/master/dist/leaflet.geometryutil.js"></script>

    <!-- Start Auto complete -->
    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <script src="//code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
    <!-- End Auto complete --> 


    <style>
      #idirection {  width: 400px; height: 200px; background-color: #ccc; padding: 10px; line-height: 25px; position: absolute; top: 10px; left: 350px; z-index: 11; }

      /* start css for autocomplete  : http://www.pontikis.net/blog/jquery-ui-autocomplete-step-by-step */
      /* highlight results */
      .ui-autocomplete span.hl_results {
          background-color: #ffff66;
      }
       
      /* loading - the AJAX indicator */
      .ui-autocomplete-loading {
          background: white url('../img/ui-anim_basic_16x16.gif') right center no-repeat;
      }
       
      /* scroll results */
      .ui-autocomplete {
          max-height: 250px;
          overflow-y: auto;
          /* prevent horizontal scrollbar */
          overflow-x: hidden;
          /* add padding for vertical scrollbar */
          padding-right: 5px;
      }
       
      .ui-autocomplete li {
          font-size: 16px;
      }
       
      /* IE 6 doesn't support max-height
      * we use height instead, but this forces the menu to always be this tall
      */
      * html .ui-autocomplete {
          height: 250px;
      }
      /* start css for autocomplete */

      .map-box {  width: 100%; height: 100%; float: left;}
    </style>


</head>
 <body ng-app="app">
  <section class="vbox">
    <header class="bg-dark dk header navbar navbar-fixed-top-xs">
      <div class="navbar-header aside-md">
        <a class="btn btn-link visible-xs" data-toggle="class:nav-off-screen" data-target="#nav">
          <i class="fa fa-bars"></i>
        </a>
        <a href="#" class="navbar-brand" data-toggle="fullscreen"><img src="images/logotx.png" class="m-r-sm">Devices -:- WebMonitor</a>
        <a class="btn btn-link visible-xs" data-toggle="dropdown" data-target=".nav-user">
          <i class="fa fa-cog"></i>
        </a>
      </div>
      
      <!--
      <ul class="nav navbar-nav hidden-xs">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle dker" data-toggle="dropdown">
            <i class="fa fa-building-o"></i> 
            <span class="font-bold">Activity</span>
          </a>
          <section class="dropdown-menu aside-xl on animated fadeInLeft no-borders lt">
            <div class="wrapper lter m-t-n-xs">
              <a href="#" class="thumb pull-left m-r">
                <img src="images/avatar.jpg" class="img-circle">
              </a>
              <div class="clear">
                <a href="#"><span class="text-white font-bold">@Mike Mcalidek</a></span>
                <small class="block">Art Director</small>
                <a href="#" class="btn btn-xs btn-success m-t-xs">Upgrade</a>
              </div>
            </div>
            <div class="row m-l-none m-r-none m-b-n-xs text-center">
              <div class="col-xs-4">
                <div class="padder-v">
                  <span class="m-b-xs h4 block text-white">245</span>
                  <small class="text-muted">Followers</small>
                </div>
              </div>
              <div class="col-xs-4 dk">
                <div class="padder-v">
                  <span class="m-b-xs h4 block text-white">55</span>
                  <small class="text-muted">Likes</small>
                </div>
              </div>
              <div class="col-xs-4">
                <div class="padder-v">
                  <span class="m-b-xs h4 block text-white">2,035</span>
                  <small class="text-muted">Photos</small>
                </div>
              </div>
            </div>
          </section>
        </li>
        <li>
          <div class="m-t m-l">
            <a href="price.html" class="dropdown-toggle btn btn-xs btn-primary" title="Upgrade"><i class="fa fa-long-arrow-up"></i></a>
          </div>
        </li>
      </ul>      
      <ul class="nav navbar-nav navbar-right hidden-xs nav-user">
        <li class="hidden-xs">
          <a href="#" class="dropdown-toggle dk" data-toggle="dropdown">
            <i class="fa fa-bell"></i>
            <span class="badge badge-sm up bg-danger m-l-n-sm count">2</span>
          </a>
          <section class="dropdown-menu aside-xl">
            <section class="panel bg-white">
              <header class="panel-heading b-light bg-light">
                <strong>You have <span class="count">2</span> notifications</strong>
              </header>
              <div class="list-group list-group-alt animated fadeInRight">
                <a href="#" class="media list-group-item">
                  <span class="pull-left thumb-sm">
                    <img src="images/avatar.jpg" alt="John said" class="img-circle">
                  </span>
                  <span class="media-body block m-b-none">
                    Use awesome animate.css<br>
                    <small class="text-muted">10 minutes ago</small>
                  </span>
                </a>
                <a href="#" class="media list-group-item">
                  <span class="media-body block m-b-none">
                    1.0 initial released<br>
                    <small class="text-muted">1 hour ago</small>
                  </span>
                </a>
              </div>
              <footer class="panel-footer text-sm">
                <a href="#" class="pull-right"><i class="fa fa-cog"></i></a>
                <a href="#notes" data-toggle="class:show animated fadeInRight">See all the notifications</a>
              </footer>
            </section>
          </section>
        </li>
        <li class="dropdown hidden-xs">
          <a href="#" class="dropdown-toggle dker" data-toggle="dropdown"><i class="fa fa-fw fa-search"></i></a>
          <section class="dropdown-menu aside-xl animated fadeInUp">
            <section class="panel bg-white">
              <form role="search">
                <div class="form-group wrapper m-b-none">
                  <div class="input-group">
                    <input type="text" class="form-control" placeholder="Search">
                    <span class="input-group-btn">
                      <button type="submit" class="btn btn-info btn-icon"><i class="fa fa-search"></i></button>
                    </span>
                  </div>
                </div>
              </form>
            </section>
          </section>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">
            <span class="thumb-sm avatar pull-left">
              <img src="images/avatar.jpg">
            </span>
            John.Smith <b class="caret"></b>
          </a>
          <ul class="dropdown-menu animated fadeInRight">
            <span class="arrow top"></span>
            <li>
              <a href="#">Settings</a>
            </li>
            <li>
              <a href="profile.html">Profile</a>
            </li>
            <li>
              <a href="#">
                <span class="badge bg-danger pull-right">3</span>
                Notifications
              </a>
            </li>
            <li>
              <a href="docs.html">Help</a>
            </li>
            <li class="divider"></li>
            <li>
              <a href="modal.lockme.html" data-toggle="ajaxModal" >Logout</a>
            </li>
          </ul>
        </li>
      </ul>      
      -->

    </header>
    <section>
      <section class="hbox stretch">
        <!-- .aside -->
        <aside class="bg-light lter b-r aside-md hidden-print" id="nav">          
          <section class="vbox">
            <!--
            <header class="header bg-primary lter text-center clearfix">
              <div class="btn-group">
                <button type="button" class="btn btn-sm btn-dark btn-icon" title="New project"><i class="fa fa-plus"></i></button>
                <div class="btn-group hidden-nav-xs">
                  <button type="button" class="btn btn-sm btn-primary dropdown-toggle" data-toggle="dropdown">
                    Switch Project
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu text-left">
                    <li><a href="#">Project</a></li>
                    <li><a href="#">Another Project</a></li>
                    <li><a href="#">More Projects</a></li>
                  </ul>
                </div>
              </div>
            </header>
          -->

            <div id="idirection" style="display:none;" >
              <legend>Direction: </legend>
              <div >From:   <font id="FromDir"></font></div>
              <div >To:     <font id="ToDir"></font></div>
              <div >Distance: <font id="DistanceDir"></font></div>
              <div >Time:   <font id="TimeDir"></font></div>      
              <div>
                <input type="button" id="ClearDir" value="Clear" onClick="LbisLocatorClear();" >
                <input type="button" id="ClearDir" value="Close" onClick="LbisLocatorClose();" >        
              </div>
              <div>&nbsp;</div>
            </div>



            <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
              <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <legend>Direction: </legend>
                    <div >From:   <font id="FromDir"></font></div>
                    <div >To:     <font id="ToDir"></font></div>
                    <div >Distance: <font id="DistanceDir"></font></div>
                    <div >Time:   <font id="TimeDir"></font></div>      
                    <div>
                      <input type="button" id="ClearDir" value="Clear" onClick="LbisLocatorClear();" >
                      <input type="button" id="ClearDir" value="Close" onClick="LbisLocatorClose();" >        
                    </div>
                    <div>&nbsp;</div>
                </div>
              </div>
            </div>


            <section class="w-f scrollable">
              <div class="slim-scroll" data-height="auto" data-disable-fade-out="true" data-distance="0" data-size="5px" data-color="#333333">
                
                <!-- nav -->
                <nav class="nav-primary hidden-xs">

                  <ul class="nav">






                    <li>
                      <a href="#layout"  >
                        <i class="fa fa-columns icon">
                          <b class="bg-warning"></b>
                        </i>
                        <span class="pull-right">
                          <i class="fa fa-angle-down text"></i>
                          <i class="fa fa-angle-up text-active"></i>
                        </span>
                        <span>Find Location</span>
                      </a>
                      <ul class="nav lt">
                        <li>
                        <div class="col-sm-12">
                          <div class="form-group">
                            &nbsp;<br>
                            <input type="text" name="psgnearby" id="psgnearby" maxlength="100" value="" class="form-control" >
                          </div>
                          <div class="form-group">
                            <input type="button" id="PinStart"  value="Start"       onClick="PinStart();"                   class="btn btn-sm btn-default">
                            <input type="button" id="PinEnd"  value="Destination"   onClick="PinDestination();"             class="btn btn-sm btn-default">
                          </div>
                          <!--div class="form-group">
                            <input type="button" id="ShowTaxi"  value="Show Taxi"     onClick="getallTaxiList_socket();"    class="btn btn-sm btn-default">
                            <input type="button" id="ShowPsg"   value="Show Passenger"  onClick="getallPsgListInterval();"  class="btn btn-sm btn-default">
                          </div-->                         
                        </div>                          
                        </li>
                      </ul>
                    </li>   



                    <li>
                      <a href="#layout"  >
                        <i class="fa fa-columns icon">
                          <b class="bg-warning"></b>
                        </i>
                        <span class="pull-right">
                          <i class="fa fa-angle-down text"></i>
                          <i class="fa fa-angle-up text-active"></i>
                        </span>
                        <span>Taxi</span>
                      </a>
                      <ul class="nav lt">
                        <li>
                          <div class="col-sm-12">
                            <div class="form-group">                            
                              <label>Plate</label>
                              <input type="text" name="taxiSplate" id="taxiSplate"  maxlength="100"  class="form-control">
                            <!--
                              <label>Phone</label> 
                              <input type="text" name="taxiSphone" id="taxiSphone" maxlength="100"  class="form-control">
                            -->
                            </div>
                            <div class="form-group">                      
                              <div class="input-daterange input-group" id="datepicker">
                              <input type="text"  name="DTstart" id="DTstart" class="form-control" />
                              <span class="input-group-addon">to</span>
                              <input type="text"  name="DTend" id="DTend" class="form-control" />
                              </div>
                            </div>
                            <div class="form-group">
                              <input type="button" id="moreFields" value="Search" onClick="getTSearchList();" class="btn btn-sm btn-default">
                            </div>                        
                          </div>                          
                        </li>
                      </ul>
                    </li>                    



                    <li>
                      <a href="#layout"  >
                        <i class="fa fa-columns icon">
                          <b class="bg-warning"></b>
                        </i>
                        <span class="pull-right">
                          <i class="fa fa-angle-down text"></i>
                          <i class="fa fa-angle-up text-active"></i>
                        </span>
                        <span>Passenger</span>
                      </a>
                      <ul class="nav lt">
                        <li>
                          <div class="col-sm-12">
                            <div class="form-group">                            
                              <label>Phone</label>
                              <input type="text" name="psgSphone" id="psgSphone"  maxlength="100" class="form-control" >
                            <!--
                              <label>Name</label>
                              <input type="text" name="psgsSname" id="psgsSname"  maxlength="100" class="form-control" >
                            -->
                            </div>
                            <div class="form-group"> 
                              <div class="input-daterange input-group" id="datepicker">
                              <input type="text"  name="DPstart" id="DPstart" class="form-control" />
                              <span class="input-group-addon">to</span>
                              <input type="text"  name="DPend" id="DPend" class="form-control" />
                              </div>
                            </div>
                            <div class="form-group"> 
                              <input type="button" id="moreFields" value="Search" onClick="getPSearchList();" class="btn btn-sm btn-default">
                            </div>
                          </div>                          
                        </li>
                      </ul>
                    </li>



                    <li>
                      <a href="#layout"  >
                        <i class="fa fa-columns icon">
                          <b class="bg-warning"></b>
                        </i>
                        <span class="pull-right">
                          <i class="fa fa-angle-down text"></i>
                          <i class="fa fa-angle-up text-active"></i>
                        </span>
                        <span>Test socket</span>
                      </a>
                      <ul class="nav lt">
                        <li >
                          <a href="layout-c.html" >                                                        
                            <i class="fa fa-angle-right"></i>
                            <span>
                            <div class="form-group" id="control">
                              <label>Test :: </label><input type="text" name="jwj000" id="jwj000" maxlength="100" value="" class="form-control" >
                            </div>
                            </span>
                          </a>
                        </li>



                        <li >
                          <a href="layout-c.html" >                                                        
                            <i class="fa fa-angle-right"></i>
                            <span>
                            <div class="form-group" id="control">
                              <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                            </div>
                            </span>
                          </a>
                        </li>
                      </ul>
                    </li>







                    <li>
                      <a href="#layout"  >
                        <i class="fa fa-columns icon">
                          <b class="bg-warning"></b>
                        </i>
                        <span class="pull-right">
                          <i class="fa fa-angle-down text"></i>
                          <i class="fa fa-angle-up text-active"></i>
                        </span>
                        <span>View Devices</span>
                      </a>
                      <ul class="nav lt">
                        <li >
                          <a href="layout-c.html" >                                                        
                            <i class="fa fa-angle-right"></i>
                            <span>
                            <div class="form-group" id="control">
                              {{infoTx}}
                            </div>
                            </span>
                          </a>
                        </li>
                      </ul>
                    </li>
                    <li>
                      <a href="#layout"  >
                        <i class="fa fa-columns icon">
                          <b class="bg-warning"></b>
                        </i>
                        <span class="pull-right">
                          <i class="fa fa-angle-down text"></i>
                          <i class="fa fa-angle-up text-active"></i>
                        </span>
                        <span>View Passengers</span>
                      </a>
                      <ul class="nav lt">
                        <li >
                          <a href="layout-c.html" >                                                        
                            <i class="fa fa-angle-right"></i>
                            <span>
                            <div class="form-group" id="control">
                              {{infoPg}}
                            </div>
                            </span>
                          </a>
                        </li>
                      </ul>
                    </li>                    













                  </ul>






                  <!-- nav
                  <ul class="nav">
                    <li >
                      <a href="index.html"  >
                        <i class="fa fa-dashboard icon">
                          <b class="bg-danger"></b>
                        </i>
                        <span>Workset</span>
                      </a>
                    </li>
                    <li >
                      <a href="#layout"  >
                        <i class="fa fa-columns icon">
                          <b class="bg-warning"></b>
                        </i>
                        <span class="pull-right">
                          <i class="fa fa-angle-down text"></i>
                          <i class="fa fa-angle-up text-active"></i>
                        </span>
                        <span>Layouts</span>
                      </a>
                      <ul class="nav lt">
                        <li >
                          <a href="layout-c.html" >                                                        
                            <i class="fa fa-angle-right"></i>
                            <span>Color option</span>
                          </a>
                        </li>
                        <li >
                          <a href="layout-r.html" >                                                        
                            <i class="fa fa-angle-right"></i>
                            <span>Right nav</span>
                          </a>
                        </li>
                        <li >
                          <a href="layout-h.html" >                                                        
                            <i class="fa fa-angle-right"></i>
                            <span>H-Layout</span>
                          </a>
                        </li>
                      </ul>
                    </li>
                    <li >
                      <a href="#uikit"  >
                        <i class="fa fa-flask icon">
                          <b class="bg-success"></b>
                        </i>
                        <span class="pull-right">
                          <i class="fa fa-angle-down text"></i>
                          <i class="fa fa-angle-up text-active"></i>
                        </span>
                        <span>UI kit</span>
                      </a>
                      <ul class="nav lt">
                        <li >
                          <a href="buttons.html" >                                                        
                            <i class="fa fa-angle-right"></i>
                            <span>Buttons</span>
                          </a>
                        </li>
                        <li >
                          <a href="icons.html" >                            
                            <b class="badge bg-info pull-right">369</b>                                                        
                            <i class="fa fa-angle-right"></i>
                            <span>Icons</span>
                          </a>
                        </li>
                        <li >
                          <a href="grid.html" >                                                        
                            <i class="fa fa-angle-right"></i>
                            <span>Grid</span>
                          </a>
                        </li>
                        <li >
                          <a href="widgets.html" >                            
                            <b class="badge  pull-right">8</b>                                                        
                            <i class="fa fa-angle-right"></i>
                            <span>Widgets</span>
                          </a>
                        </li>
                        <li >
                          <a href="components.html" >                                                        
                            <i class="fa fa-angle-right"></i>
                            <span>Components</span>
                          </a>
                        </li>
                        <li >
                          <a href="list.html" >                                                        
                            <i class="fa fa-angle-right"></i>
                            <span>List group</span>
                          </a>
                        </li>
                        <li >
                          <a href="#table" >                            
                            <i class="fa fa-angle-down text"></i>
                            <i class="fa fa-angle-up text-active"></i>
                            <span>Table</span>
                          </a>
                          <ul class="nav bg">
                            <li >
                              <a href="table-static.html" >
                                <i class="fa fa-angle-right"></i>
                                <span>Table static</span>
                              </a>
                            </li>
                            <li >
                              <a href="table-datatable.html" >
                                <i class="fa fa-angle-right"></i>
                                <span>Datatable</span>
                              </a>
                            </li>
                            <li >
                              <a href="table-datagrid.html" >
                                <i class="fa fa-angle-right"></i>
                                <span>Datagrid</span>
                              </a>
                            </li>
                          </ul>
                        </li>
                        <li >
                          <a href="#form" >                            
                            <i class="fa fa-angle-down text"></i>
                            <i class="fa fa-angle-up text-active"></i>
                            <span>Form</span>
                          </a>
                          <ul class="nav bg">
                            <li >
                              <a href="form-elements.html" >
                                <i class="fa fa-angle-right"></i>
                                <span>Form elements</span>
                              </a>
                            </li>
                            <li >
                              <a href="form-validation.html" >
                                <i class="fa fa-angle-right"></i>
                                <span>Form validation</span>
                              </a>
                            </li>
                            <li >
                              <a href="form-wizard.html" >
                                <i class="fa fa-angle-right"></i>
                                <span>Form wizard</span>
                              </a>
                            </li>
                          </ul>
                        </li>
                        <li >
                          <a href="chart.html" >                                                        
                            <i class="fa fa-angle-right"></i>
                            <span>Chart</span>
                          </a>
                        </li>
                        <li >
                          <a href="fullcalendar.html" >                                                        
                            <i class="fa fa-angle-right"></i>
                            <span>Fullcalendar</span>
                          </a>
                        </li>
                        <li >
                          <a href="portlet.html" >                                                        
                            <i class="fa fa-angle-right"></i>
                            <span>Portlet</span>
                          </a>
                        </li>
                        <li >
                          <a href="timeline.html" >                                                        
                            <i class="fa fa-angle-right"></i>
                            <span>Timeline</span>
                          </a>
                        </li>
                      </ul>
                    </li>
                    <li  class="active">
                      <a href="#pages"   class="active">
                        <i class="fa fa-file-text icon">
                          <b class="bg-primary"></b>
                        </i>
                        <span class="pull-right">
                          <i class="fa fa-angle-down text"></i>
                          <i class="fa fa-angle-up text-active"></i>
                        </span>
                        <span>Pages</span>
                      </a>
                      <ul class="nav lt">
                        <li >
                          <a href="gallery.html" >                                                        
                            <i class="fa fa-angle-right"></i>
                            <span>Gallery</span>
                          </a>
                        </li>
                        <li >
                          <a href="profile.html" >                                                        
                            <i class="fa fa-angle-right"></i>
                            <span>Profile</span>
                          </a>
                        </li>
                        <li >
                          <a href="invoice.html" >                                                        
                            <i class="fa fa-angle-right"></i>
                            <span>Invoice</span>
                          </a>
                        </li>
                        <li >
                          <a href="intro.html" >                                                        
                            <i class="fa fa-angle-right"></i>
                            <span>Intro</span>
                          </a>
                        </li>
                        <li >
                          <a href="master.html" >                                                        
                            <i class="fa fa-angle-right"></i>
                            <span>Master</span>
                          </a>
                        </li>
                        <li  class="active">
                          <a href="gmap.html"  class="active">                                                        
                            <i class="fa fa-angle-right"></i>
                            <span>Google Map</span>
                          </a>
                        </li>
                        <li >
                          <a href="signin.html" >                                                        
                            <i class="fa fa-angle-right"></i>
                            <span>Signin</span>
                          </a>
                        </li>
                        <li >
                          <a href="signup.html" >                                                        
                            <i class="fa fa-angle-right"></i>
                            <span>Signup</span>
                          </a>
                        </li>
                        <li >
                          <a href="404.html" >                                                        
                            <i class="fa fa-angle-right"></i>
                            <span>404</span>
                          </a>
                        </li>
                      </ul>
                    </li>
                    <li >
                      <a href="mail.html"  >
                        <b class="badge bg-danger pull-right">3</b>
                        <i class="fa fa-envelope-o icon">
                          <b class="bg-primary dker"></b>
                        </i>
                        <span>Message</span>
                      </a>
                    </li>
                    <li >
                      <a href="notebook.html"  >
                        <i class="fa fa-pencil icon">
                          <b class="bg-info"></b>
                        </i>
                        <span>Notes</span>
                      </a>
                    </li>
                  </ul>
                </nav>
                -->
                <!-- / nav -->
              </div>

              <!-- Button trigger modal -->
              <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">
                Launch demo modal
              </button>

              <!-- Modal -->
              <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                      <h4 class="modal-title" id="myModalLabel">Modal title</h4>
                    </div>
                    <div class="modal-body">
                      ...
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                      <button type="button" class="btn btn-primary">Save changes</button>
                    </div>
                  </div>
                </div>
              </div>


              <div>
                {{test}}
              </div>








            </section>
            
            <footer class="footer lt hidden-xs b-t b-light">
              <div id="chat" class="dropup">
                <section class="dropdown-menu on aside-md m-l-n">
                  <section class="panel bg-white">
                    <header class="panel-heading b-b b-light">Active chats</header>
                    <div class="panel-body animated fadeInRight">
                      <p class="text-sm">No active chats.</p>
                      <p><a href="#" class="btn btn-sm btn-default">Start a chat</a></p>
                    </div>
                  </section>
                </section>
              </div>
              <div id="invite" class="dropup">                
                <section class="dropdown-menu on aside-md m-l-n">
                  <section class="panel bg-white">
                    <header class="panel-heading b-b b-light">
                      John <i class="fa fa-circle text-success"></i>
                    </header>
                    <div class="panel-body animated fadeInRight">
                      <p class="text-sm">No contacts in your lists.</p>
                      <p><a href="#" class="btn btn-sm btn-facebook"><i class="fa fa-fw fa-facebook"></i> Invite from Facebook</a></p>
                    </div>
                  </section>
                </section>
              </div>
              <a href="#nav" data-toggle="class:nav-xs" class="pull-right btn btn-sm btn-default btn-icon">
                <i class="fa fa-angle-left text"></i>
                <i class="fa fa-angle-right text-active"></i>
              </a>
              <div class="btn-group hidden-nav-xs">
                <button type="button" title="Chats" class="btn btn-icon btn-sm btn-default" data-toggle="dropdown" data-target="#chat"><i class="fa fa-comment-o"></i></button>
                <button type="button" title="Contacts" class="btn btn-icon btn-sm btn-default" data-toggle="dropdown" data-target="#invite"><i class="fa fa-facebook"></i></button>
              </div>
            </footer>
          </section>
        </aside>
        <!-- /.aside -->
        <section id="content">


          <section class="hbox stretch">
            <aside class="aside-md bg-white b-r" id="subNav">
              <div class="wrapper b-b header">Submenu Header</div>
              <div ng-controller="MainController as main">
                
<div class="container">
    <h1>{{main.title}}</h1>
    <div class="input-group">
        <span class="input-group-addon">
            <span class="glyphicon glyphicon-search"></span>
        </span>
        <input type="text" class="form-control" ng-model="main.searchInput">
    </div>
    <h3>A list of TV shows</h3>
    <ul class="list-group">
        <li class="list-group-item" ng-repeat="show in main.shows | filter:main.searchInput | orderBy:main.order.key:main.order.reverse"><span class="glyphicon glyphicon-star" ng-if="show.favorite"></span> {{show.title}} <span class="badge">{{show.year}}</span></li>
    </ul>
    <select class="form-control pull-right" ng-model="main.order" ng-options="order as order.title for order in main.orders"></select>
    <div class="clearfix"></div>
    <h3>Add a new TV Show</h3>
    <form name="main.addForm" class="form">
        <div class="form-group">
            <label>Title</label>
            <input type="text" class="form-control" ng-model="main.new.title" required />
        </div>
        <div class="form-group">
            <label>Year</label>
            <input type="number" min="1900" max="2030" class="form-control" ng-model="main.new.year" required />
        </div>
        <div class="row">
            <div class="col-xs-6">
                <label>Favorite: <input type="checkbox" ng-model="main.new.favorite" /></label>
            </div>
            <div class="col-xs-6">
                <button class="btn btn-success pull-right"><span class="glyphicon glyphicon-plus-sign"></span> Add</button>
            </div>
        </div>
    </form>
</div>
                

                {{DevicesList}}

                {{PassengersList}}
              </div>
              <!--
              <ul class="nav">
                <li class="b-b b-light"><a href="#"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>Phasellus at ultricies</a></li>
                <li class="b-b b-light"><a href="#"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>Malesuada augue</a></li>
                <li class="b-b b-light"><a href="#"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>Donec eleifend</a></li>
                <li class="b-b b-light"><a href="#"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>Dapibus porta</a></li>
                <li class="b-b b-light"><a href="#"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>Dacus eu neque</a></li>
              </ul>
              -->
            </aside>

            <aside>
              <section class="vbox">

                <header class="header bg-white b-b clearfix">
                  <div class="row m-t-sm">
                    <div class="col-sm-8 m-b-xs">
                      <a href="#subNav" data-toggle="class:hide" class="btn btn-sm btn-default active">
                        <i class="fa fa-caret-right text fa-lg"></i>
                        <i class="fa fa-caret-left text-active fa-lg"></i>
                      </a>

                      <!--
                      <div class="btn-group">
                        <button type="button" class="btn btn-sm btn-default" title="Refresh"><i class="fa fa-refresh"></i></button>
                        <button type="button" class="btn btn-sm btn-default" title="Remove"><i class="fa fa-trash-o"></i></button>
                        <button type="button" class="btn btn-sm btn-default" title="Filter" data-toggle="dropdown"><i class="fa fa-filter"></i> <span class="caret"></span></button>
                        <ul class="dropdown-menu">
                          <li><a href="#">Action</a></li>
                          <li><a href="#">Another action</a></li>
                          <li><a href="#">Something else here</a></li>
                          <li class="divider"></li>
                          <li><a href="#">Separated link</a></li>
                        </ul>
                      </div>
                      <a href="modal.html" data-toggle="ajaxModal" class="btn btn-sm btn-default"><i class="fa fa-plus"></i> Create</a>
                      -->
                    </div>
                    <div class="col-sm-4 m-b-xs">
                      <div class="input-group">
                        <!--
                        <input type="text" class="input-sm form-control" placeholder="Search">
                        <span class="input-group-btn">
                          <button class="btn btn-sm btn-default" type="button">Go!</button>
                        </span>
                        -->
                      </div>
                    </div>
                  </div>
                </header>

                <section id="map" style="min-height:240px;">
                </section>     

              </section>
            </aside>
          </section>







          <section class="vbox bg-white">




            <!--
            <header class="header b-b">
              <form method="post" id="geocoding_form" class="input-s m-t-sm m-b-none pull-right">
                <div class="input-group">                  
                    <input type="text" id="address" name="address" class="input-sm form-control" placeholder="Search">
                    <span class="input-group-btn">
                      <button class="btn btn-sm btn-default" type="submit">Go!</button>
                    </span>
                </div>
              </form>
              <p>Google Maps</p>
            </header>
            -->


            <!--section id="gmap_geocoding" style="min-height:240px;">          
            </section-->



            <div id="popup-infoa" class="alert alert-info alert-dismissible drag-info ui-draggable" role="alert" style="position:absolute; left: 50px; top: 10px; z-index: 999;">
              <span id="vpopupinfo" style="font-size:13px;">
              <!--Center: 16.080461,100.298259
              <br>
              Distance: 304968.87
              <br>
              Heading: 6.32739366679551
              <br>
              Tilt: 0.00
              <br>
              <i>Altitude:</i>
              304968.41
              <br-->
              </span>
            </div>








        <!--      
        <div>
          <label>Input:</label>
          <input type="text" ng-model="yourInput" placeholder="type your input">
          <br/>
          <h1>Your input is {{yourInput}} </h1>
        </div>
        <div> - </div>
        <div ng-controller="TodoController">
        <h1>Todos</h1>
        <h4>{{todos.length}} remain</h4>
        <ul>
          <li ng-repeat="todo in filteredTodos">{{todo.text}}</li>
        </ul>
        <div data-pagination="" data-num-pages="numPages()" 
          data-current-page="currentPage" data-max-size="maxSize"  
          data-boundary-links="true"></div>
            
          </section>
          <a href="#" class="hide nav-off-screen-block" data-toggle="class:nav-off-screen" data-target="#nav"></a>
        </section>
        <aside class="bg-light lter b-l aside-md hide" id="notes">
          <div class="wrapper">Notification</div>
        </aside>
        </div>
        -->



      </section>

    </section>

  </section>

  <!--script src="js/jquery.min.js"></script-->
  <!-- Bootstrap -->
  <script src="js/bootstrap.js"></script>
  <!-- App -->
  <script src="js/app.js"></script>
  <script src="js/app.plugin.js"></script>
  <script src="js/slimscroll/jquery.slimscroll.min.js"></script>


</body>
  
  <script>

  $( "#popup-infoa" ).draggable();
  
  var socket = io.connect('http://54.200.72.141:1112');
  
  var map = H.map("map");
  var drawControl = new L.Control.Draw();

  var marker;
  var nLayer;
  var kml;
  var fires24;
  var toggleState = true;
  var jsonPoiList = 0;

  var CStartingP;
  var CEndingP;
  var CStartingPlat;
  var CStartingPlng;
  var CEndingPlat;
  var CEndingPlng;

  var OSEPolyline;
  var SEPolyline;

  var markerS;
  var markerD;
  var putTaxi;    
  var putPsg;

  var animatedMarker;
  var polyline_123;

  var g_puid;  
  var g_tuid;

  var PsgLayer = {};
  var TaxiCurLayer = {};
  var PsgCurLayer = {};
  var vpopupinfo;


  map.setView([13.753,100.571], 10);

  map.on('draw:created', function (e) {
    var type = e.layerType,
    layer = e.layer;
    map.addLayer(layer);
  });




/***********************start initiate pin**********************************/
  $(function(){
    getPINAllDevices();
    getPINAllPassengers();    
  });



  function getPINAllDevices() {   
  console.log('getPINAllDevices')
    $.ajax({
        url : "/service/getInitDevices",
        type: "GET",
        success: function(JsonData){
            console.log('success getPINAllDevices')
            console.log(JsonData);

            $.each(JsonData.data, function(i, item) {  
        console.log(item.latitude+','+item.longitude+':'+item.status)
              var myIcon = L.icon({
                iconUrl: '/assets/img/map/taxi_pin'+item.status+'.png',
                  iconSize: [50,50],
                  iconAnchor: [25,25],
                  shadowUrl: null  
              });   

              console.log('/assets/img/map/taxi_pin'+item.status+'.png')
              
        var tempmk = item.uid;

              if (item.status == 1||item.status == 3||item.status == 4) {
                if(map.hasLayer(TaxiCurLayer[tempmk])) {
                  map.removeLayer(TaxiCurLayer[tempmk]);
                }    
                
                vpopupinfo = '<b>License:</b> '+item.carLicense+'<br><b>Type:</b> '+item.carType+'<br><b>พิกัด:</b> '+ item.latitude +' , '+ item.longitude + '<br><b>Altitude:</b> ' + item.altitude + '<br><b>Decibels:</b> ' + item.decibels + '<br><b>Light:</b> ' + item.light + '<br><b>Carspeed:</b> ' + item.carSpeed + '<br><b>Accuracy:</b> ' + item.direction.accuracy;   
                
                $("#vpopupinfo").html(vpopupinfo);
                
                TaxiCurLayer[tempmk] = new L.marker([item.latitude,item.longitude], {icon: myIcon, angle:item.direction.degree}).whitePopup('License: '+item.carLicense+'<br>Type: '+item.carType+'<br>พิกัด: '+ item.latitude +' , '+ item.longitude + '<br>Altitude: ' + item.altitude + '<br>Decibels: ' + item.decibels + '<br>Light: ' + item.light + '<br>Carspeed: ' + item.carSpeed + '<br>Accuracy: ' + item.direction.accuracy);
                map.addLayer(TaxiCurLayer[tempmk]);
              } else {
                if(map.hasLayer(TaxiCurLayer[tempmk])) {
                  map.removeLayer(TaxiCurLayer[tempmk]);
                }
              } 

            });
        }
    });      
  } 



  function getPINAllPassengers() {   
  console.log('getPINAllPassenger')
    $.ajax({
        url : "/service/getInitPassengers",
        type: "GET",
        success: function(JsonData){
            console.log('success getPINAllPassenger')
            console.log(JsonData);
             //addPoiJson(data.geoJson);
            console.log('hey!!!!!! Pin Psg-location... ');    

            $.each(JsonData.data, function(i, item) {              
              
              var PsgmyIcon = L.icon({
                iconUrl: '/assets/img/map/pin-passenger'+item.status+'.png',
                  iconSize: [50,50],
                  iconAnchor: [25,25],
                  shadowUrl: null
              });  

              var tempmk = item.uid;

              if (item.status == 1||item.status == 3||item.status == 4) {
                if(map.hasLayer(PsgCurLayer[tempmk])) {
                  map.removeLayer(PsgCurLayer[tempmk]);
                }         
                PsgCurLayer[tempmk] = new L.marker([item.latitude,item.longitude], {icon: PsgmyIcon}).whitePopup('ID: '+item.uid+'<br>Phone: '+item.phoneNumber+'<br>Address: '+item.address+'<br>Location: '+ item.latitude +' , '+ item.longitude + '<br>Tips : ' + item.tips +'<br>Altitude: ' + item.altitude +'<br>Accelerometer: ' + item.accelerometer + '<br>Decibels: ' + item.decibels + '<br>Light: ' + item.light + '<br>Destination: ' + item.destination.name + '<br>Distance: '+ item.distance + '<br>Action : '+ item.action +'<br>Status: ' + item.status );
                map.addLayer(PsgCurLayer[tempmk]);
              } else {
                if(map.hasLayer(PsgCurLayer[tempmk])) {
                  map.removeLayer(PsgCurLayer[tempmk]);
                }
              }             

            });
  
        }
    });      
  }



/***********************end initiate pin**********************************/



  $(function() {    
    $("#psgnearby").autocomplete({ 
        source: function (request, response) { 
            $.ajax({ 
                type: "POST", 
                contentType: "application/json; charset=utf-8", 
                url: "http://locator-dev.ecartmap.com/locator/poi", 
                dataType: "json", 
                data: "{'Name':'" + request.term + "'}", 
                success: function (data) { 
                  //console.log(data)
                  response($.map(data, function (item) {                      
                      return { 
                          //label: item.Name + '(' + item.Value + ')',
                            label: item.Name, value: item.Name, latlng: item.Lat+','+item.Long
                            } 
                        } //return
                        ) //(data
                  )   //$.map
                } 
            }); 
        }, 
        minLength: 2, 
        select: function (event, ui) {          
          var setlatlng = ui.item.latlng; 
          //alert(setlatlng);
          //map.setView([.split','],15);
          map.setView(setlatlng.split(','),13)
        }, 
        open: function () { 
            $(this).removeClass("ui-corner-all").addClass("ui-corner-top"); 
        }, 
        close: function () { 
            $(this).removeClass("ui-corner-top").addClass("ui-corner-all"); 
        }, 
        error: function (XMLHttpRequest, textStatus, errorThrown) { 
            alert(textStatus); 
        } 
    }); 
  });
  
  

  $(function() {    
    $("#psgSphone").autocomplete({ 
        source: function (request, response) { 
        var data = {
          phoneNumber : $('#psgSphone').val(),
        };        
        //var dataphone = { phoneNumber: '0843112347' } 
            $.ajax({ 
                type: "POST", 
                //contentType: "application/json; charset=utf-8", 
                url: "/service/getPsgbyPhone", 
                dataType: "json",                 
                //data: "{'phoneNumber':'" + request.term + "' }", 
                data: data,
                success: function (data) {                    
                  response($.map(data.data, function (item) {                     
                      return {
                            label: item.phoneNumber, value: item.phoneNumber, uid: item.uid
                            } 
                        } //return
                        ) //(data
                  )   //$.map
                } 
            });
        }, 
        minLength: 2, 
        select: function (event, ui) {
          g_puid = ui.item.uid;          
        }, 
        open: function () { 
            $(this).removeClass("ui-corner-all").addClass("ui-corner-top"); 
        }, 
        close: function () { 
            $(this).removeClass("ui-corner-top").addClass("ui-corner-all"); 
        }, 
        error: function (XMLHttpRequest, textStatus, errorThrown) { 
            alert(textStatus); 
        } 
    });
  });
  
  
  
  $(function() {    
    $("#psgsSname").autocomplete({ 
        source: function (request, response) { 
        var data = {
          name : $('#psgsSname').val(),
        };                
            $.ajax({ 
                type: "POST",                 
                url: "/service/getPsgbyName", 
                dataType: "json",                                 
                data: data,
                success: function (data) {                    
                  response($.map(data.data, function (item) {                     
                      return {
                            label: item.name, value: item.name, uid: item.uid
                            } 
                        } //return
                        ) //(data
                  )   //$.map
                } 
            });
        }, 
        minLength: 2, 
        select: function (event, ui) {
        }, 
        open: function () { 
            $(this).removeClass("ui-corner-all").addClass("ui-corner-top"); 
        }, 
        close: function () { 
            $(this).removeClass("ui-corner-top").addClass("ui-corner-all"); 
        }, 
        error: function (XMLHttpRequest, textStatus, errorThrown) { 
            alert(textStatus); 
        } 
    });
  });
  
  
  

  $(function() {    
    $("#taxiSplate").autocomplete({ 
        source: function (request, response) { 
        var data = {
          carLicense : $('#taxiSplate').val(),
        };                
            $.ajax({ 
                type: "POST",                 
                url: "/service/getDvbyPlate", 
                dataType: "json",                                 
                data: data,
                success: function (data) {                    
                  response($.map(data.data, function (item) {                   
                      return {
                            label: item.carLicense, value: item.carLicense, uid: item.uid                        
                            } 
                        } //return
                        ) //(data
                  )   //$.map
                } 
            });
        }, 
        minLength: 2, 
        select: function (event, ui) {
          g_tuid = ui.item.uid;
        }, 
        open: function () { 
            $(this).removeClass("ui-corner-all").addClass("ui-corner-top"); 
        }, 
        close: function () { 
            $(this).removeClass("ui-corner-top").addClass("ui-corner-all"); 
        }, 
        error: function (XMLHttpRequest, textStatus, errorThrown) { 
            alert(textStatus); 
        } 
    });
  });
  
  
  
  $(function() {    
    $("#taxiSphone").autocomplete({ 
        source: function (request, response) { 
        var data = {
          phoneNumber : $('#taxiSphone').val(),
        };                
            $.ajax({ 
                type: "POST",                 
                url: "/service/getDvbyPhone", 
                dataType: "json",                                 
                data: data,
                success: function (data) {                    
                  response($.map(data.data, function (item) {                     
                      return {
                            label: item.phoneNumber, value: item.phoneNumber, uid: item.uid
                            } 
                        } //return
                        ) //(data
                  )   //$.map
                } 
            });
        }, 
        minLength: 2, 
        select: function (event, ui) {
        }, 
        open: function () { 
            $(this).removeClass("ui-corner-all").addClass("ui-corner-top"); 
        }, 
        close: function () { 
            $(this).removeClass("ui-corner-top").addClass("ui-corner-all"); 
        }, 
        error: function (XMLHttpRequest, textStatus, errorThrown) { 
            alert(textStatus); 
        } 
    });
  });
  
  
  
  // Get Search List
  function getPSearchList_node(){
    var data = {
      psgSphone : $('#psgSphone').val(),
      psgsSname : $('#psgsSname').val(),      
      DPstart: $('#DPstart').val(),
      DPend: $('#DPend').val(),
    };

    $.ajax({
        url : "/service/getPSearchList",
        type: "POST",
        data: data,
        success: function(data){
            //console.log(data)
        }
    }); 
  }



  function getPSearchList(){
    /*
    var data = {      
      taxiSplate1: g_tuid ,//$('#taxiSplate').val(),
      taxiSphone: $('#taxiSphone').val(),
      DTstart: $('#DTstart').val(),
      DTend: $('#DTend').val(),
    };
    */
    ////
    var DPstart =  new Date($('#DPstart').val());  
    var stD = DPstart.toISOString();
    var DPend = new Date($('#DPend').val());  
    var enD = DPend.toISOString();
    $.ajax({
        /*   ----> Strong loop is working!!! ---*/
        url:"http://192.168.23.23:3000/api/pathlogs?access_token=12910310"+
            "&filter[fields][latitude]=true"+
            "&filter[fields][longitude]=true"+
            "&filter[fields][timeStamp]=true"+
            "&filter[fields][uid]=true"+
            "&filter[where][latitude][gt]0"+
            "&filter[where][uid]="+g_puid+                
            "&filter[where][and][0][timeStamp][gte]="+stD+
            "&filter[where][and][1][timeStamp][lte]="+enD+
            "&filter[limit]=100",
        //url:"/service/getPSearchList",
        type: "GET",        
        success: function(data){
            
        if(map.hasLayer(animatedMarker)) {
          map.removeLayer(animatedMarker);
        }
        if(map.hasLayer(polyline_123)) {
          map.removeLayer(polyline_123);
        }
        var json = data;
        var arr = []; 

        for(var i = 0; i < json.length; i++) {  
          arr.push([parseFloat(json[i].latitude),parseFloat(json[i].longitude)])
        };
        //console.log(arr[0]);
        map.setView(arr[0],13);
        polyline_123 = L.polyline(arr); // create polyline
        polyline_123.addTo(map);
        //console.log(arr);
        var line = L.polyline(arr);
        var myIcon = L.icon({
          iconUrl: '../assets/img/y-taxi-ico.png',
            iconSize: [25, 39],
            iconAnchor: [12, 39],
            shadowUrl: null         
          //iconUrl: 'img/marker-icon.png'          
        });       
        animatedMarker = L.animatedMarker(line.getLatLngs(), {
          icon: myIcon,
            //distance: 300,  // meters
            //interval: 2000, // milliseconds
            onEnd: function() {
              // TODO: blow up this marker
            }           
        });
        map.addLayer(animatedMarker);
        }
    }); 
  }



  // https://developers.google.com/maps/documentation/javascript/reference#Marker > Google Maps Javascript API V3 Reference
  // Get Search List
  function getTSearchList(){
    
    var data = {      
      taxiSplate: g_tuid ,//$('#taxiSplate').val(),
      taxiSphone: $('#taxiSphone').val(),
      DTstart: $('#DTstart').val(),
      DTend: $('#DTend').val(),
    };
    
    /* --- Use for Strongloop
    var DTstart =  new Date($('#DTstart').val());  
    var stD = DTstart.toISOString();
    var DTend = new Date($('#DTend').val()); 
    var enD = DTend.toISOString();
    */
    $.ajax({
        /*   ----> Strong loop is working!!! 
        url:"http://192.168.23.23:3000/api/pathlogs?access_token=12910310"+
            "&filter[fields][latitude]=true"+
            "&filter[fields][longitude]=true"+
            "&filter[fields][timeStamp]=true"+
            "&filter[fields][uid]=true"+
            "&filter[where][latitude][gt]0"+
            "&filter[where][uid]="+g_tuid+                
            "&filter[where][and][0][timeStamp][gte]="+stD+
            "&filter[where][and][1][timeStamp][lte]="+enD+
            "&filter[limit]=100",
        type: "GET",
        and NO data: data, in strongloop
        */
        url:"/service/getTSearchList",
        type: "POST",
        data: data, 

        success: function(data){
            
        if(map.hasLayer(animatedMarker)) {
          map.removeLayer(animatedMarker);
        }
        if(map.hasLayer(polyline_123)) {
          map.removeLayer(polyline_123);
        }
        var json = data;
        var arr = []; 

        for(var i = 0; i < json.length; i++) {  
          arr.push([parseFloat(json[i].latitude),parseFloat(json[i].longitude)])
        };
        //console.log(arr[0]);
        map.setView(arr[0],13);
        polyline_123 = L.polyline(arr); // create polyline
        polyline_123.addTo(map);
        //console.log(arr);
        var line = L.polyline(arr);
        var myIcon = L.icon({
          iconUrl: '../assets/img/y-taxi-ico.png',
            iconSize: [25, 39],
            iconAnchor: [12, 39],
            shadowUrl: null         
          //iconUrl: 'img/marker-icon.png'          
        });       
        animatedMarker = L.animatedMarker(line.getLatLngs(), {
          icon: myIcon,
            //distance: 300,  // meters
            //interval: 2000, // milliseconds
            onEnd: function() {
              // TODO: blow up this marker
            }           
        });
        map.addLayer(animatedMarker);
        }
    }); 
  }



  function getTSearchList_node(){
    var data = {      
      taxiSplate: g_tuid ,//$('#taxiSplate').val(),
      taxiSphone: $('#taxiSphone').val(),
      DTstart: $('#DTstart').val(),
      DTend: $('#DTend').val(),
    };

    $.ajax({
        url : "/service/getTSearchList",
        type: "POST",
        data: data,
        //url : "http://localhost:3000/api/pathlogs?filter[fields][latitude]=true&filter[fields][longitude]=true&filter[where][latitude][gt]0",
        //type: "GET",        
        success: function(data){
            console.log(data)           
            //console.log('anchor')
            if(map.hasLayer(animatedMarker)) {
          map.removeLayer(animatedMarker);
        }
        if(map.hasLayer(polyline_123)) {
          map.removeLayer(polyline_123);
        }
        var json = data;
        var arr = [];       
        for(var i = 0; i < json.data.length; i++) {         
          arr.push([parseFloat(json.data[i].latitude),parseFloat(json.data[i].longitude)])
        };
        //console.log(arr[0]);
        map.setView(arr[0],13);
        polyline_123 = L.polyline(arr); // create polyline
        polyline_123.addTo(map);
        //console.log(arr);
        var line = L.polyline(arr);
        var myIcon = L.icon({
          iconUrl: '../assets/img/y-taxi-ico.png',
            iconSize: [25, 39],
            iconAnchor: [12, 39],
            shadowUrl: null         
          //iconUrl: 'img/marker-icon.png'          
        });       
        animatedMarker = L.animatedMarker(line.getLatLngs(), {
          icon: myIcon,
            //distance: 300,  // meters
            //interval: 2000, // milliseconds
            onEnd: function() {
              // TODO: blow up this marker
            }           
        });
        map.addLayer(animatedMarker);
        }
    }); 
  }



  $(function() {
    $( "#DPstart" ).datepicker({});
    $( "#DPend" ).datepicker({});
  });



  $(function() {
    $( "#DTstart" ).datepicker({
      //dateFormat: 'dd-mm-yy' 
    });
    $( "#DTend" ).datepicker({});
  });



  $(function() {
    socket.on('SendEachTaxiLocation',function(data){      
    console.log(data);
    data = decodeURIComponent(escape(data));    
    //var myIcon = L.icon({iconUrl: '/assets/img/map/taxi_pin.png'});
 
      console.log('hey!!!!!! โชว์taxi-location... ');     
      var Jsondata = JSON.parse(data);
      console.log(Jsondata.uid);
      console.log('Tx: ' + Jsondata.status);

      var myIcon = L.icon({
        iconUrl: '/assets/img/map/taxi_pin'+Jsondata.status+'.png',
          iconSize: [50,50],
          iconAnchor: [25,25],
          shadowUrl: null
      });  

      var tempmk = Jsondata.uid;

      if (Jsondata.status == 1||Jsondata.status == 3||Jsondata.status == 4) {
        if(map.hasLayer(TaxiCurLayer[tempmk])) {
          map.removeLayer(TaxiCurLayer[tempmk]);
        }    
        
        vpopupinfo = '<b>License:</b> '+Jsondata.carLicense+'<br><b>Type:</b> '+Jsondata.carType+'<br><b>พิกัด:</b> '+ Jsondata.latitude +' , '+ Jsondata.longitude + '<br><b>Altitude:</b> ' + Jsondata.altitude + '<br><b>Decibels:</b> ' + Jsondata.decibels + '<br><b>Light:</b> ' + Jsondata.light + '<br><b>Carspeed:</b> ' + Jsondata.carSpeed + '<br><b>Accuracy:</b> ' + Jsondata.direction.accuracy;   
        
        $("#vpopupinfo").html(vpopupinfo);
        
        TaxiCurLayer[tempmk] = new L.marker([Jsondata.latitude,Jsondata.longitude], {icon: myIcon, angle:Jsondata.direction.degree}).whitePopup('License: '+Jsondata.carLicense+'<br>Type: '+Jsondata.carType+'<br>พิกัด: '+ Jsondata.latitude +' , '+ Jsondata.longitude + '<br>Altitude: ' + Jsondata.altitude + '<br>Decibels: ' + Jsondata.decibels + '<br>Light: ' + Jsondata.light + '<br>Carspeed: ' + Jsondata.carSpeed + '<br>Accuracy: ' + Jsondata.direction.accuracy);
        map.addLayer(TaxiCurLayer[tempmk]);
      } else {
        if(map.hasLayer(TaxiCurLayer[tempmk])) {
          map.removeLayer(TaxiCurLayer[tempmk]);
        }
      }   
    }); 



    socket.on('Getjwj000',function(data){     
      data = decodeURIComponent(escape(data));
      console.log(data);
      $("#jwj000").val(data)
    }); 



    socket.on('SendEachPsgLocation',function(data){      
    console.log(data);
    data = decodeURIComponent(escape(data));    
    //var myIcon = L.icon({iconUrl: '/assets/img/map/taxi_pin.png'}); 
      console.log('hey!!!!!! โชว์ Psg-location... ');     
      var Jsondata = JSON.parse(data);
      console.log(Jsondata.uid);
      console.log('psg: ' + Jsondata.status);
      var tempmk = Jsondata.uid;
      var PsgmyIcon = L.icon({
        iconUrl: '/assets/img/map/pin-passenger'+Jsondata.status+'.png',
          iconSize: [50,50],
          iconAnchor: [25,25],
          shadowUrl: null
      });  
      if (Jsondata.status == 1||Jsondata.status == 3||Jsondata.status == 4) {
        if(map.hasLayer(PsgCurLayer[tempmk])) {
          map.removeLayer(PsgCurLayer[tempmk]);
        }         
        PsgCurLayer[tempmk] = new L.marker([Jsondata.latitude,Jsondata.longitude], {icon: PsgmyIcon}).whitePopup('ID: '+Jsondata.uid+'<br>Phone: '+Jsondata.phoneNumber+'<br>Address: '+Jsondata.address+'<br>Location: '+ Jsondata.latitude +' , '+ Jsondata.longitude + '<br>Tips : ' + Jsondata.tips +'<br>Altitude: ' + Jsondata.altitude +'<br>Accelerometer: ' + Jsondata.accelerometer + '<br>Decibels: ' + Jsondata.decibels + '<br>Light: ' + Jsondata.light + '<br>Destination: ' + Jsondata.destination.name + '<br>Distance: '+ Jsondata.distance + '<br>Action : '+ Jsondata.action +'<br>Status: ' + Jsondata.status );
        map.addLayer(PsgCurLayer[tempmk]);
      } else {
        if(map.hasLayer(PsgCurLayer[tempmk])) {
          map.removeLayer(PsgCurLayer[tempmk]);
        }
      }   
    }); 

  });



  /*
  $(function() {
    socket.emit('get all passenger',{msg:'request'});
    socket.on('show all passenger',function(data){
      //alert('her its html show all passenger !!');
      //console.log(data);
        var psgsearchAuto = [         ];
    });
    socket.emit('get all device',{msg:'request'});
    socket.on('show all device',function(data){     
      console.log(data);
      addPoiJson(data);
    });
  });
  */



  $(function(){
    /*
    checkGPS(function(){      
      getAllPassenger ();
    });
    */
    
    // socket.on('news', function (data) {
    //     console.log(data);
    //     socket.emit('my other event', { my: 'data' });
    // });

  });



  function checkGPS(callback){    
    if(navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          //console.log('lat =>'+position.coords.latitude+' || lon =>'+position.coords.longitude);
          JsonData = { "type": "Point", "coordinates": [position.coords.longitude, position.coords.latitude] }
          if( jsonPoiList != 0 ){ map.removeLayer(jsonPoiList); }
          addPoiJsongps(JsonData);
          callback();
        }, function() {
          console.log("Can not get your location !!");
        });
    }
  }



  function addPoiJsongps(JsonData) {  
     var myIcon = L.icon({iconUrl: 'http://leafletjs.com/dist/images/marker-icon.png'});     
     var myStyle = {
      color: '#f00',
      fillColor: '#ffc4c4',
      weight: 2,
      opacity: 0.8,
      icon: myIcon,     
      iconUrl: 'img/map/taxi_pin.png'
     };
     jsonPoiList = L.geoJson(JsonData, {
        style: myStyle
     });
     map.addLayer(jsonPoiList); 
     map.fitBounds(jsonPoiList.getBounds());
     map.setZoom(15);
  }



  function addPoi(JsonData) {
  //console.log('add poi');    
   var myIcon = L.icon({iconUrl: 'http://leafletjs.com/dist/images/marker-icon.png'});  
   var myStyle = {
    color: '#f00',
    fillColor: '#ffc4c4',
    weight: 2,
    opacity: 0.8,
    icon: myIcon,     
    iconUrl: 'img/map/taxi_pin.png'
   };
    console.log('hey!!!!!!');
    $.each(JsonData.data, function(i, item) {
      console.log(item.lat +' , '+item.lng) ;       
      putMarker = new L.marker([item.lat,item.lng], {icon: myIcon, style: myStyle});
      map.addLayer(putMarker);        
    });

  }



  /* -----------------------------------------
      Get passenger list (all)
       ----------------------------------------- */
  function getAllPassenger () {
    console.log('getAllPassenger');   
    // $.ajax({
    //     url : "/service/getPassenger/all",
    //     type: "GET",
    //     success: function(data){
    //          console.log(data);
    //          addPoiJson(data.geoJson);
    //     }
    // });
    socket.emit('get all passenger',{msg:'request get all passenger'});
    socket.on('show all passenger',function(data){
      //alert('her its html show all passenger !!');
      console.log(data);
      addPoi(data);
    });
  }



  /* -----------------------------------------
      Get passenger by ID
    ----------------------------------------- */    
  function getPassengerById () {
    var data = {
      uid: '555',
      name: 'สมหมาย',
      carLicense: 'ดก-4448',
      lat: 13.3, 
      lng: 100.1,
      distance: 200,
      detail: '',
      status: 3
    };

    $.ajax({
        url : "/service/getPassenger/5555",
        type: "POST",
        data : data,
        success: function(data){
            console.log(data)
        }
    });
  }




  /* -----------------------------------------
      Get passenger
       ----------------------------------------- */

  function updatePassenger () {
    var data = {
      uid: '555',
      registrationId: 'sdfadsgjakfdg',
      name: 'สมหมาย',
      carLicense: 'ดก-4448',
      lat: 13.33333333, 
      lng: 100.11243256,
      distance: 200,
      detail: '',
      passengerID: '',
      status: 1
    };

    $.ajax({
        url : "/service/getPassenger",
        type: "POST",
        data : data,
        success: function(data){
            console.log(data)
        }
    });
  }

  

  /* -----------------------------------------
    POST Taxi need to cancel passenger 
       ----------------------------------------- */

       function updateDevice () {

    var data = {
      uid: '555',
      name: 'สมหมาย',
      carLicense: 'ดก-4448',
      lat: 13.456, 
      lng: 100.11243256,
      distance: 4564,
      detail: '',
      passengerID: '0001',
      status: 1
    };

    $.ajax({
        url : "service/device/updateStatus",
        type: "POST",
        data : data,
        success: function(data){
            console.log(data)
        }
    });

  }


  /* -----------------------------------------
    POST Taxi need to picup passenger
       ----------------------------------------- */

  function updateDeviceWaiting () {

    var data = {
      uid: '555',
      name: 'สมหมาย',
      carLicense: 'ดก-4448',
      lat: 13.456, 
      lng: 100.11243256,
      distance: 4564,
      detail: '',
      passengerID: '0001',
      status: 5
    };

    $.ajax({
        url : "service/device/updateStatus",
        type: "POST",
        data : data,
        success: function(data){
            console.log(data)
        }
    });

  }




  /* -----------------------------------------
      Get Taxi
       ----------------------------------------- */
  function getallTaxiListInterval(){      
    getallTaxiList();   
    setInterval(function() {      
      getallTaxiList();       
    },  40000);
  }



  function getallTaxiList_socket() {    
    //socket.emit('get all device',{msg:'request get all device'});
    socket.on(' show all device',function(data){      
      console.log(data);
      addPoiJson(data);
    });

  }


  function getallTaxiList() {
    /*
    var data = {
      uid: '5555',
      registrationId: 'ljfglkdf',
      name: 'สมบัติ',
      phoneNumber: '0843112347',
      lat: 13.0, 
      lng: 100.9,
      distance: 200,
      detail: '',
      destination: 'กรุงเทพ',
      status: 1
    };
    */    
    $.ajax({
        url : "/service/getDeviceSocket/all",
        type: "GET",        
        success: function(data){              
            if(map.hasLayer(putTaxi)) {
          map.removeLayer(putTaxi);
        }
            addPoiJson(data);
        }
    });
  }



  function addPoiJson(JsonData) {
    // console.log(putTaxi);
     var myIcon = L.icon({      
      //shadowUrl: 'img/map/leaf-shadow.png',
      iconUrl: 'img/map/taxi_pin.png',
        //iconSize: [25, 39],
        //iconAnchor: [12, 39],
        shadowUrl: null       
     });
     var myStyle = {
      color: '#f00',
      fillColor: '#ffc4c4',
      weight: 2,
      opacity: 0.8,
      icon: myIcon,     
      iconUrl: 'img/map/taxi_pin.png'
     }; 

      //console.log(map.hasLayer(putTaxi))

          if(map.hasLayer(putTaxi)) {
        map.removeLayer(putTaxi);
      }       

      $.each(JsonData.data, function(i, item) {
          console.log(item.latitude +' , '+item.longitude) ;        
        putTaxi = new L.marker([item.latitude,item.longitude], {icon: myIcon, style: myStyle, angle:item.direction.degree}).whitePopup("<b>"+item.name+"</b><br />Plate:"+item.carLicense+'<br>พิกัด'+ item.latitude +','+ item.longitude );
        map.addLayer(putTaxi);  
      });
  }



  function getallPsgListInterval(){ 
    getallPsgList();    
    setInterval(function() {      
      getallPsgList();
    }, 10000);
  }



  function getallPsgList() {
    var data = {
      uid: '555',
      registrationId: 'sdfadsgjakfdg',
      name: 'สมหมาย',
      carLicense: 'ดก-4448',
      lat: 13.33333333, 
      lng: 100.11243256,
      distance: 200,
      detail: '',
      passengerID: '',
      status: 1
    };      
    $.ajax({
        url : "/service/getPassenger",
        type: "POST",
        data : data,
        success: function(data){              
            if(map.hasLayer(putPsg)) {
          map.removeLayer(putPsg);
        }
            addPoiJsonPsg(data);
        }
    });
  }



  function addPoiJsonPsg(JsonData) {
    //console.log(putPsg);
    var myIcon = L.icon({       
      iconUrl: 'img/map/pin-passenger.png',
      shadowUrl: 'img/map/leaf-shadow.png'
     });
     var myStyle = {
      color: '#f00',
      fillColor: '#ffc4c4',
      weight: 2,
      opacity: 0.8,
      icon: myIcon,     
      iconUrl: 'img/map/pin-passenger.png'
     };   
      // console.log(map.hasLayer(putTaxi))             
      $.each(JsonData.data, function(i, item) {
          console.log(item.lat +' , '+item.lng) ; 
        putPsg = new L.marker([item.lat,item.lng], {icon: myIcon, style: myStyle}).whitePopup("<b>"+item.name+"</b><br />Plate:"+item.phoneNumber+'<br>พิกัด'+ item.lat +','+ item.lng );
        map.addLayer(putPsg); 
      });
  }




  /* -----------------------------------------
      Get Taxi list (all)
       ----------------------------------------- */
  function getAllTaxi () {

    $.ajax({
        url : "/service/getDevice/all",
        type: "GET",
        success: function(data){
            //console.log(data)
        }
    });

  }



  function PinStart(){
    var myIcon = L.icon({
        iconUrl: '../img/map/pin-passenger.png',
        // iconRetinaUrl: 'my-icon@2x.png',
        // iconSize: [38, 95],
        iconAnchor: [25, 25],
        // popupAnchor: [-3, -76],
        // shadowUrl: 'my-icon-shadow.png',
        // shadowRetinaUrl: 'my-icon-shadow@2x.png',
        // shadowSize: [68, 95],
        // shadowAnchor: [22, 94]
    });

    var pinCenter = map.getCenter();      
    markerS = L.marker(pinCenter,{icon: myIcon, draggable: true });     
    markerS.bindLabel('Start', {noHide: true});
    markerS.addTo(map);
    map.setView(pinCenter,15);
    //markerS.dragging.enable();
    markerS.on('dragend', function(e) {         
        //CStartingP = markerS.getLatLng();
        CStartingPlat = markerS.getLatLng().lat;
        CStartingPlng = markerS.getLatLng().lng;          
      //markerS.bindPopup('<p>Please confirm the starting point<br><center><input type="button" value="START"></center></p>').openPopup();

      $.ajax({
          url : "http://proxy.hmap-dev.ecartmap.com/getDirection.php?url=https%3A//maps.googleapis.com/maps/api/directions/json%3Forigin%3D"+CStartingPlat+"%2C"+CStartingPlng+"%26destination%3D"+CEndingPlat+"%2C"+CEndingPlng+"%26waypoints%3Doptimize%3Atrue%26mode%3Ddriving%26language%3DTH%26sensor%3Dfalse%26key%3DZNViRo_sRGCtsSc3BeC280Rlprg%3D%26client%3Dgme-ecartstudiocompany&dummy=0.5774756167083979%20200%20OK%201417ms",
          type: "GET",
          success: function(data){
            var enc = data.routes[0].overview_polyline.points;
            var straddr = data.routes[0].legs[0].start_address;
            var endaddr = data.routes[0].legs[0].end_address;
            var tim = data.routes[0].legs[0].duration.text;
            var dis = data.routes[0].legs[0].distance.text;

            $('#FromDir').text(straddr);
            $('#ToDir').text(endaddr);
            $('#DistanceDir').text(dis);
            $('#TimeDir').text(tim);

            var polyDecode = map.navigation._decodeGoogle(enc);
            if (OSEPolyline!=undefined) {               
              map.removeLayer(OSEPolyline);
              OSEPolyline = L.polyline(polyDecode).addTo(map);
            } else {
              OSEPolyline = L.polyline(polyDecode).addTo(map);
            }
              //console.log(data);
              $("#idirection").show();
          }
      });

    });     
  }



  function PinDestination(){
    //http://proxy.hmap-dev.ecartmap.com/getDirection.php?url=https%3A//maps.googleapis.com/maps/api/directions/json%3Forigin%3D13.76339577962447%2C100.3546142578125%26destination%3D13.92073799964004%2C100.55511474609375%26waypoints%3Doptimize%3Atrue%26mode%3Ddriving%26language%3DTH%26sensor%3Dfalse%26key%3DZNViRo_sRGCtsSc3BeC280Rlprg%3D%26client%3Dgme-ecartstudiocompany&dummy=0.5774756167083979%20200%20OK%201417ms
    var myIcon = L.icon({
        iconUrl: '../img/map/pin-destination.png',
        // iconRetinaUrl: 'my-icon@2x.png',
        // iconSize: [38, 95],
        iconAnchor: [25, 25],
        // popupAnchor: [-3, -76],
        // shadowUrl: 'my-icon-shadow.png',
        // shadowRetinaUrl: 'my-icon-shadow@2x.png',
        // shadowSize: [68, 95],
        // shadowAnchor: [22, 94]
    });

    var pinCenter = map.getCenter();      
    markerD = L.marker(pinCenter, {icon: myIcon, draggable: true});
    markerD.bindLabel('Destination', {noHide: true});
    markerD.addTo(map);
    map.setView(pinCenter,15);
    //markerD.dragging.enable();
    markerD.on('dragend', function(e) {         
        //CEndingP = markerD.getLatLng();
        CEndingPlat = markerD.getLatLng().lat;
        CEndingPlng = markerD.getLatLng().lng;

      $.ajax({          
          url : "http://proxy.hmap-dev.ecartmap.com/getDirection.php?url=https%3A//maps.googleapis.com/maps/api/directions/json%3Forigin%3D"+CStartingPlat+"%2C"+CStartingPlng+"%26destination%3D"+CEndingPlat+"%2C"+CEndingPlng+"%26waypoints%3Doptimize%3Atrue%26mode%3Ddriving%26language%3DTH%26sensor%3Dfalse%26key%3DZNViRo_sRGCtsSc3BeC280Rlprg%3D%26client%3Dgme-ecartstudiocompany&dummy=0.5774756167083979%20200%20OK%201417ms",
          type: "GET",
          success: function(data){
            var enc = data.routes[0].overview_polyline.points;
            var straddr = data.routes[0].legs[0].start_address;
            var endaddr = data.routes[0].legs[0].end_address;
            var tim = data.routes[0].legs[0].duration.text;
            var dis = data.routes[0].legs[0].distance.text;

            $('#FromDir').text(straddr);
            $('#ToDir').text(endaddr);
            $('#DistanceDir').text(dis);
            $('#TimeDir').text(tim);              

            var polyDecode = map.navigation._decodeGoogle(enc);             
            if (OSEPolyline!=undefined) {               
              map.removeLayer(OSEPolyline);
              OSEPolyline = L.polyline(polyDecode).addTo(map);
            } else {
              OSEPolyline = L.polyline(polyDecode).addTo(map);
            }
            $("#idirection").show();
            //console.log(dis);
            //console.log(tim);
              //console.log(data);
              //map.clearLayer();
          }
      });

        //markerD.bindPopup('<p>Please confirm the destination point<br><center><input type="button" value="DESTINATION"></center></p>').openPopup();
    });     
  }



  function LbisLocatorClear(){
    map.removeLayer(markerS); 
    map.removeLayer(markerD); 
    map.removeLayer(OSEPolyline);
      $('#FromDir').text('');
      $('#ToDir').text('');
      $('#DistanceDir').text('');
      $('#TimeDir').text('');         
    //map.removeLayer(putTaxi);
  }


  
  function LbisLocatorClose(){
    map.removeLayer(markerS); 
    map.removeLayer(markerD); 
    map.removeLayer(OSEPolyline);
      $('#FromDir').text('');
      $('#ToDir').text('');
      $('#DistanceDir').text('');
      $('#TimeDir').text('');         
    $("#idirection").hide();
  }



  socket.on('ShowPsgLocation', function (data) {          
      //console.log(data);
      addPoiPsg(data);
  });



  function addPoiPsg(JsonData) {
  //console.log('add poi');    
   var myIcon = L.icon({iconUrl: '/assets/img/map/pin-passenger.png'});
   
   var myStyle = {
    color: '#f00',
    fillColor: '#ffc4c4',
    weight: 2,
    opacity: 0.8,
    icon: myIcon,     
    iconUrl: 'img/map/pin-passenger.png'
   };
    console.log('hey!!!!!! น้องไอยรา ... ');
    //console.log(JsonData.tempid);
    console.log(JsonData.tempid);
    var tempmk = JsonData.tempid;
    
    if(map.hasLayer(PsgLayer[tempmk])) {
      map.removeLayer(PsgLayer[tempmk]);
    }

    PsgLayer[tempmk] = new L.marker([JsonData.coordinates[1],JsonData.coordinates[0]], {icon: myIcon, style: myStyle}).whitePopup('<b>พิกัด '+ JsonData.coordinates[1] +' , '+ JsonData.coordinates[0]);
        //console.log(PsgLayer[tempmk])

    map.addLayer(PsgLayer[tempmk]); 

    //map.fitBounds(jsonPoiList.getBounds());
    //map.setView([JsonData.coordinates[1],JsonData.coordinates[0]],15);          
    /*
    $.each(JsonData, function(i,item) {
      console.log(item);
      //console.log(item.coordinates);
        //console.log(item.lat +' , '+item.lng) ;       
      putMarker = new L.marker([item.lat,item.lng], {icon: myIcon, style: myStyle});
      map.addLayer(putMarker);        
    });
    */
    /*
    for (temp in JsonData) {
      console.log(JsonData[temp])
      console.log(temp)
    }
    */


  }

  </script>


</html>